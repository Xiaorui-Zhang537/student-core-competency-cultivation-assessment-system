## 管理员端：深度数据中心（课程/学生/AI审计/导出）

本文档说明管理员端新增的“深度数据中心”能力：管理员可从课程进入学生画像，查看成绩、能力雷达与报告、AI 行为洞察、AI 问答与口语训练记录，并支持 CSV/PDF/ZIP 导出。

### 1. 信息架构（页面入口）

- **课程总览**：`/admin/courses`
  - 点击“查看”进入课程深度页：`/admin/courses/:id`
- **课程深度页**：`/admin/courses/:id`
  - Tab：内容 / 学生 / 成绩 / 报告
  - 在“学生”Tab 中点击“查看画像”进入：`/admin/courses/:courseId/students/:studentId`
- **学生画像 360**：`/admin/students/:id` 或 `.../courses/:courseId/students/:studentId`
  - 面板：成绩、雷达与报告、行为洞察、AI问答、口语训练
  - 支持页面级导出 PDF；AI 会话与口语会话支持 ZIP 导出（含 JSON/Markdown）

- **AI/口语审计页（独立入口）**：`/admin/audit/:userId`
  - Tab：AI 问答 / 口语训练
  - 支持音频回放与 ZIP 导出（最多打包 50 个音频文件）

### 2. 后端 API（管理员专用）

#### 2.1 课程与学生名单

- `GET /api/admin/courses/{id}`：课程详情（含在读人数）
- `GET /api/admin/courses/{id}/students`：管理员分页查询课程学生名单（支持 search/sort/filter）
- `GET /api/admin/exports/course-students.csv?courseId=...`：导出课程学生名单 CSV

#### 2.2 能力雷达（管理员版）

- `GET /api/admin/ability/radar?studentId=...&courseId=...`：学生五维雷达（学生 vs 班级均值）
- `POST /api/admin/ability/radar/compare`：A/B 区间或作业集对比

#### 2.3 行为洞察（管理员版）

- `GET /api/admin/behavior/insights?studentId=...&courseId=...&range=7d`：获取最新洞察
- `POST /api/admin/behavior/insights/generate?...`：生成洞察

#### 2.4 AI 问答审计（管理员版）

- `GET /api/admin/ai/conversations?studentId=...`：会话列表（分页）
- `GET /api/admin/ai/conversations/{id}?studentId=...`：会话详情
- `GET /api/admin/ai/conversations/{id}/messages?studentId=...`：会话消息（分页）
- `GET /api/admin/exports/ai-conversations.csv?studentId=...`：导出会话索引 CSV

#### 2.5 口语训练审计（管理员版）

- `GET /api/admin/ai/voice/sessions?studentId=...`：语音会话列表
- `GET /api/admin/ai/voice/sessions/{sessionId}?studentId=...`：语音会话详情
- `GET /api/admin/ai/voice/sessions/{sessionId}/turns?studentId=...`：回合列表
- `GET /api/admin/exports/voice-sessions.csv?studentId=...`：导出口语会话索引 CSV

#### 2.6 成绩与能力报告（复用既有接口）

- 成绩：
  - `GET /api/grades/student/{studentId}/page?courseId=...`
  - `GET /api/grades/student/{studentId}/trend?courseId=...&days=30`
  - `GET /api/grades/course/{courseId}/statistics`
- 能力报告：
  - `GET /api/admin/ability-reports?studentId=...&courseId=...`
  - `GET /api/admin/exports/ability-reports.csv?...`

### 3. 导出策略（前端/后端协作）

- **CSV**：优先由后端同步生成 Blob（管理员导出中心模式），前端统一走 `downloadCsv(...)` 下载。
- **PDF**：前端页面级导出（`exportNodeAsPdf`），确保玻璃风格在导出时可读。
- **ZIP**：前端按“会话/口语会话”打包 JSON/Markdown（可继续扩展为附件文件打包）。

### 4. 注意事项（合规与审计）

AI 问答与口语训练属于敏感数据。管理员访问相关接口时，后端会通过 `AdminAuditLogService` 记录审计日志（操作人、对象ID、参数与来源）。

### 5. 全局通知（群发）

管理员可在工具中心进行全局通知群发，策略为 **按用户逐条写入 `notifications` 表**（复用通知中心 UI，不引入新的“公告表”）。

- `POST /api/notifications/admin/broadcast`
  - `targetType=all|role|specific`
  - `role=student|teacher|admin`（当 targetType=role）
  - `targetIds=[...]`（当 targetType=specific）

