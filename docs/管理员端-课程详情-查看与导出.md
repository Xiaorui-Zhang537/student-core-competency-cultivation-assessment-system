## 管理员端-课程详情：查看与导出

本文档用于说明管理员在课程详情页（`/admin/courses/:id`）可查看的内容与可导出的数据，以及导出文件包含的字段与注意事项。

### 入口与页面结构

- **入口**：管理员中心 → 课程总览 → 进入某课程详情（URL：`/admin/courses/:id`）
- **结构**：
  - **顶部概览**：课程基础信息（只读）+ KPI（占满整行）
  - **导航卡片（StartCard）**：四个卡片按钮，点击切换面板，支持高亮当前面板与显示数量
  - **四个面板 Tab**：
    - 内容
    - 学生
    - 成绩
    - 报告

### 顶部布局与导航交互

- 顶部采用两段式布局：
  - 第一段：概览卡片（全宽）
  - 第二段：导航卡片区（`grid-cols-1 md:grid-cols-2 xl:grid-cols-4`）
- 导航卡片与 URL 参数 `tab` 双向同步：
  - 点击卡片会更新 `tab` 参数
  - 直接访问带 `tab` 的链接会激活对应面板
- 当前激活卡片使用增强边框与背景高亮，未激活卡片保留玻璃态悬停反馈。

### 内容面板（章节/节次/资源/课堂笔记）

- **目录**：按章节分组展示节次列表，可展开/收起
- **节次详情（只读）**：
  - 节次说明
  - 视频：支持在线播放（HLS `.m3u8` 会自动尝试加载 `hls.js`）
  - 资料：支持在线预览（如 PDF）与下载
  - 关联作业：只展示关联信息（管理员端不提供修改/跳转改动）
- **课堂笔记（审计与导出）**：
  - 支持按 **关键词 / 学生ID / 节次** 过滤
  - 支持分页查看
  - 支持导出：
    - CSV：`/api/admin/exports/course-lesson-notes.csv?courseId={courseId}&studentId={studentId?}&lessonId={lessonId?}&q={q?}`
    - ZIP：`/api/admin/exports/course-lesson-notes.zip?...`（ZIP 内含 `lesson_notes.csv`）

### 学生面板（只读表格 + 单学生全量导出）

- **表格（只读）**：尽量对齐教师端“学生管理”表格的核心信息
  - 进度（完成节次/总节次）
  - 雷达概览（面积/分类）
  - 平均成绩、活跃度、最后活跃时间
- **操作（只读）**：
  - 查看画像：跳转到学生画像页
  - 查看笔记：在弹窗内查看该学生在本课程的课堂笔记（可筛选/导出）
  - **导出全量（ZIP）**：导出该学生在本课程的学习数据（不含个人敏感信息）

### 成绩面板（复用教师端分析能力）

- **KPI**：总人数、完成率、平均分、作业总数（来自教师端分析接口复用）
- **成绩分布**：饼图展示区间分布
- **学生排行**：按雷达排序分页展示
- **能力雷达 + 维度解析**：
  - 可选择学生作为分析对象
  - 支持对比模式（A/B 作业集）
  - 支持导出雷达 CSV

### 报告面板（在线查看 + 多格式下载 + 提交 ZIP）

- 支持按 **作业** + **学生姓名/学号关键词** 过滤能力报告列表
- 列表按“同学生 + 同作业”聚合：
  - 默认仅展示最新记录
  - 可点击“查看历史”展开旧记录（历史记录缩进显示，不重复展示学生姓名）
- 列表副标题展示教师布置的**作业名称**（不再展示 `submission #id`）
- 在线查看：
  - 报告详情弹窗已与学生端“作业提交页-查看报告弹窗”同构复用（卡片结构、字段展示、按钮顺序、排版一致）
  - 字段捕捉优先级：`trendsAnalysis -> trends_analysis -> normalizedJson -> rawJson -> raw_json -> dimensionScores`
  - 当主结构缺失时会进行归一化与扁平分数字段兜底，保证“总体 + 四维 + Evidence/Suggestions”区块可渲染
  - 弹窗居中于整个页面，且不使用背景变暗遮罩
- 下载：
  - 文本 / PDF / PNG（内容顺序与学生端一致）
  - 若报告关联 submission：支持导出 submission ZIP（`/submissions/{submissionId}/export`）

### 全量导出（ZIP）

页面提供两类全量导出：

- **课程级全量导出（ZIP）**：`/api/admin/exports/course-data.zip?courseId={courseId}`
  - `course_student_summary.csv`：每个学生一行的课程汇总宽表，包含：
    - 学生标识：`studentId / studentName / studentNo`
    - 学习总览：`progress / completedLessons / totalLessons / averageGrade / activityLevel / lastActiveAt`
    - 雷达信息：`radarArea / radarClassification`
    - 五维能力展开列：每个维度 `score + level`，以及 `dimensionAverageScore / dimensionAverageLevel`
    - 每个作业展开列：`assignment_{id}_title / score / percentage / gradeLevel`
  - `course_student_assignment_grades.csv`：课程维度下所有作业成绩明细，包含 `studentId / studentName / studentNo`，并附带五维能力展开列与维度均分列
  - `ability_reports.csv`：课程维度下所有能力报告（含 submissionId/createdAt）
  - `course_lesson_notes.csv`：课程维度下所有课堂笔记（notes 非空）

- **单学生课程全量导出（ZIP）**：`/api/admin/exports/course-student-data.zip?courseId={courseId}&studentId={studentId}`
  - `assignments_grades.csv`
  - `ability_reports.csv`
  - `lesson_notes.csv`
  - `summary.json`（聚合摘要：进度/雷达/维度分/平均分等）

### 注意事项

- 导出接口为同步导出，默认上限 50,000 行；若数据量过大建议先缩小筛选范围。
- ZIP 导出 `Content-Type` 为 `application/zip`，浏览器会以文件方式下载。

